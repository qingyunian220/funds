<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>基金C份额收益率排名</title>
  <link rel="stylesheet" href="/static/layui-v2.11.6/layui/css/layui.css">
  <style>
    /* 自定义样式，使页面适应不同屏幕尺寸 */
    .layui-container {
      width: 100%;
      padding: 0 15px;
      box-sizing: border-box;
    }
    
    /* 表格自适应样式 */
    .layui-table-container {
      overflow-x: auto;
    }
    
    /* 在小屏幕上调整列宽 */
    @media screen and (max-width: 1200px) {
      .layui-table th, .layui-table td {
        font-size: 12px;
        padding: 9px 5px;
      }
    }
    
    @media screen and (max-width: 992px) {
      .layui-table th, .layui-table td {
        padding: 9px 3px;
      }
    }
    
    /* 近1年前十名基金标色 */
    .top-10 {
      background-color: #ffeb3b !important;
      font-weight: bold;
    }
    
    /* 负数显示为绿色 */
    .negative-number {
      color: #16b777 !important;
      font-weight: bold;
    }
    
    /* 正数显示为红色 */
    .positive-number {
      color: #ff5722 !important;
      font-weight: bold;
    }
    
    /* 标题区域样式 */
    .title-container {
      display: flex;
      align-items: center;
      margin-top: 20px;
    }
    .title-container h1 {
      margin-left: 15px;
    }
    
    /* 修改标题容器样式，使标题居中 */
    .layui-field-title {
      position: relative;
    }
    
    .title-content {
      position: relative;
      width: 100%;
      height: 60px;
      line-height: 60px;
    }
    
    .back-button {
      position: absolute;
      left: 0;
      top: 0;
    }
    
    .title-center {
      position: absolute;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      margin: 0;
      text-align: center;
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="layui-container">
    <div class="layui-row">
      <div class="layui-col-md12">
        <fieldset class="layui-elem-field layui-field-title">
          <div class="title-content">
            <div class="back-button">
              <a href="/" class="layui-btn layui-btn-primary layui-btn-sm">
                <i class="layui-icon layui-icon-left"></i> 返回首页
              </a>
            </div>
            <h1 class="title-center">指数增强收益率排名</h1>
          </div>
        </fieldset>
      </div>
    </div>
    
    <div class="layui-tabs" lay-filter="fundTabs">
      <ul class="layui-tabs-header">
        <li class="layui-this" lay-id="hs300">沪深300基金</li>
        <li lay-id="zz500">中证500基金</li>
          <li lay-id="a500">A500基金</li>
        <li lay-id="zz800">中证800基金</li>
        <li lay-id="zz1000">中证1000基金</li>
        <li lay-id="zz2000">中证2000基金</li>
        <li lay-id="gz2000">国证2000基金</li>
        <li lay-id="small_fund">小微盘基金</li>
      </ul>
      <div class="layui-tabs-body">
        <div class="layui-tabs-item layui-show">
          <table class="layui-table" id="hs300Table" lay-filter="hs300Table">对比基准：华泰柏瑞沪深300ETF(510300)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="zz500Table" lay-filter="zz500Table">对比基准：华泰柏瑞中证500ETF(512510)</table>
        </div>
          <div class="layui-tabs-item">
          <table class="layui-table" id="a500Table" lay-filter="a500Table">对比基准：华泰柏瑞中证A500ETF(563800)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="zz800Table" lay-filter="zz800Table">对比基准：易方达中证800ETF(515810)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="zz1000Table" lay-filter="zz1000Table">对比基准：华泰柏瑞中证1000ETF(516300)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="zz2000Table" lay-filter="zz2000Table">对比基准：华泰柏瑞中证2000ETF(563300)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="gz2000Table" lay-filter="gz2000Table">对比基准：广发国证2000ETF(159907)</table>
        </div>
        <div class="layui-tabs-item">
          <table class="layui-table" id="small_fundTable" lay-filter="small_fundTable">对比基准：诺安多策略混合(320016)</table>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/layui-v2.11.6/layui/layui.js"></script>
  <script>
  layui.use(function(){
    var $ = layui.$;
    var table = layui.table;
    var tabs = layui.tabs;
    
    // 标记多个时间段排名前十的基金
    function highlightTop10(res, currTableId) {
      // 确保数据存在
      if (!res || !res.data || res.data.length === 0) return;
      
      // 定义需要检查的时间段
      var periods = ['近1年超额','今年来超额', '近6月超额', '近3月超额', '近1月超额'];
      
      // 为每个时间段计算排名前十的基金代码
      var top10CodesByPeriod = {};
      periods.forEach(function(period) {
        // 按当前时间段收益率排序（从高到低）
        var sortedData = res.data.slice().sort(function(a, b) {
          var aVal = parseFloat(a[period]) || -Infinity;
          var bVal = parseFloat(b[period]) || -Infinity;
          return bVal - aVal;
        });
        
        // 获取前10名基金代码
        top10CodesByPeriod[period] = [];
        for (var i = 0; i < Math.min(10, sortedData.length); i++) {
          top10CodesByPeriod[period].push(sortedData[i]['基金代码']);
        }
      });
      
      // 找出在所有四个时间段都排名前十的基金代码
      var consistentlyTop10Codes = [];
      res.data.forEach(function(fund) {
        var fundCode = fund['基金代码'];
        var isInAllTop10 = periods.every(function(period) {
          return top10CodesByPeriod[period].includes(fundCode);
        });
        
        if (isInAllTop10) {
          consistentlyTop10Codes.push(fundCode);
        }
      });
      
      // 通过LAYUI的表格重载实现标色
      setTimeout(function() {
        // 查找表格中的每一行，使用LAYUI表格的实际结构
        $('#'+currTableId).next('.layui-table-view').find('.layui-table-body tbody tr').each(function() {
          var $row = $(this);
          // 获取该行第一个单元格（基金代码）
          var fundCode = $row.find('td').eq(0).text().trim();
          
          // 如果基金代码在所有四个时间段都排名前十，则添加标色样式
          if (consistentlyTop10Codes.includes(fundCode)) {
            $row.find('td').addClass('top-10');
          }
        });
      }, 100);
    }
    
    // 为所有表格注册排序事件监听器
    function registerSortListener(tableId) {
      // 使用Layui的事件监听机制，监听表格排序事件
      layui.table.on('sort(' + tableId + ')', function(obj){
        // 等待排序完成后再重新应用标色
        setTimeout(function() {
          // 重新获取当前表格数据
          var tableData = layui.table.cache[tableId];
          if (tableData) {
            var mockRes = {data: tableData};
            highlightTop10(mockRes, tableId);
          }
        }, 200);
      });
    }
    
    // 创建表格列定义
    function createTableColumns() {
      return [[
        {field: '基金代码', title: '基金代码', width: 86, align: 'center'},
        {field: '基金简称', title: '基金简称', width: 190, align: 'center'},
        {field: '近1周超额', title: '近1周超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近1周超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近1月超额', title: '近1月超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近1月超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近3月超额', title: '近3月超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近3月超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近6月超额', title: '近6月超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近6月超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近1年超额', title: '近1年超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近1年超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近2年超额', title: '近2年超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近2年超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '近3年超额', title: '近3年超额', width: 110, sort: true, align: 'center', templet: function(d) {
          var value = d['近3年超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '今年来超额', title: '今年来超额', width: 115, sort: true, align: 'center', templet: function(d) {
          var value = d['今年来超额'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 显示时添加百分号，但不影响排序
          var formattedValue = parseFloat(value).toFixed(2) + '%';
          if (parseFloat(value) < 0) {
            return '<span class="negative-number">' + formattedValue + '</span>';
          } else if (parseFloat(value) > 0) {
            return '<span class="positive-number">' + formattedValue + '</span>';
          }
          return formattedValue;
        }},
        {field: '成立时间', title: '成立时间', width: 102, align: 'center'},
        {field: '最新规模', title: '最新规模', width: 95, align: 'center'},
        {field: '换手率', title: '换手率', width: 86, align: 'center'},
        {field: '前10大重仓股占比', title: '前10大重仓股占比', width: 144, align: 'center'},
        {field: '持股行业集中度', title: '持股行业集中度', width: 128, align: 'center', templet: function(d) {
          var value = d['持股行业集中度'];
          if (value === null || value === undefined || value === '') {
            return '';
          }
          // 使用正则表达式提取百分比数值部分
          var match = value.match(/(\d+\.\d+)%/);
          if (match && match[1]) {
            return match[1] + '%';
          }
          return value;
        }}
      ]];
    }
    
    // 基金表格配置
    var fundConfigs = [
      {
        id: 'hs300',
        name: '沪深300基金',
        elem: '#hs300Table',
        url: '/get_fund_data?sheet=沪深300基金_超额'
      },
      {
        id: 'zz500',
        name: '中证500基金',
        elem: '#zz500Table',
        url: '/get_fund_data?sheet=中证500基金_超额'
      },
      {
        id: 'a500',
        name: '中证A500基金',
        elem: '#a500Table',
        url: '/get_fund_data?sheet=A500基金_超额'
      },
      {
        id: 'zz800',
        name: '中证800基金',
        elem: '#zz800Table',
        url: '/get_fund_data?sheet=中证800基金_超额'
      },
      {
        id: 'zz1000',
        name: '中证1000基金',
        elem: '#zz1000Table',
        url: '/get_fund_data?sheet=中证1000基金_超额'
      },
      {
        id: 'zz2000',
        name: '中证2000基金',
        elem: '#zz2000Table',
        url: '/get_fund_data?sheet=中证2000基金_超额'
      },
      {
        id: 'gz2000',
        name: '国证2000基金',
        elem: '#gz2000Table',
        url: '/get_fund_data?sheet=国证2000基金_超额'
      },
      {
        id: 'small_fund',
        name: '小微盘基金',
        elem: '#small_fundTable',
        url: '/get_fund_data?sheet=小微盘_超额'
      }
    ];
    
    // 渲染所有基金表格
    fundConfigs.forEach(function(config) {
      table.render({
        elem: config.elem,
        url: config.url,
        page: true,
        limit: 100,
        limits: [100, 200],
        request: {
          pageName: 'page',
          limitName: 'limit'
        },
        response: {
          statusCode: 0
        },
        cols: createTableColumns(),
        done: function(res, curr, count){
          console.log(config.name + '数据加载完成:', res);
          // 标记在多个时间段都排名前十的基金
          highlightTop10(res, config.id + 'Table');
          // 注册排序监听器
          registerSortListener(config.id + 'Table');
        },
        error: function(xhr, type, errorThrown){
          console.error(config.name + '数据加载失败:', xhr, type, errorThrown);
          console.log('响应内容:', xhr.responseText);
        }
      });
    });
    
    // 初始化 tabs
    tabs.render();
  });
  </script>
</body>
</html>